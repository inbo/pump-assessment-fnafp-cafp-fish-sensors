---
title: "BDS_TalTech_OK_Visualisation_only"
author: "Stijn Bruneel"
date: "2023-03-07"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, echo=TRUE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```

```{r}
# import libraries from file
source("./source/Libraries.R")
```

```{r}
file.final.injection.nadir <- read.csv("data/internal/Oude_Kale/BDS_TalTech/All_BDS_data_ROIs_OK_long.csv")
file.final <- read.csv("data/internal/Oude_Kale/BDS_TalTech/All_BDS_data_final_OK.csv")
```

```{r}
file.final.injection.nadir$line_type=NA
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="injection")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="nadir_pressure")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="exit")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="P0")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="P1")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="P2")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="P3")]='solid'
file.final.injection.nadir$line_type[which(file.final.injection.nadir$stage=="P4")]='solid'
file.final.injection.nadir$color=NA
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="injection")]='yellow'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="nadir_pressure")]='green'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="exit")]='orange'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="P0")]='lightblue'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="P1")]='blue'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="P2")]='darkblue'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="P3")]='purple'
file.final.injection.nadir$color[which(file.final.injection.nadir$stage=="P4")]='red'

scenario<-unique(file.final$scenario)
l <- list()
k = 0
for (s in scenario){
  file.final.scenario<-file.final[which(file.final$scenario==s),]
  sensors<-unique(file.final.scenario$sensor)
  for (i in sensors){
    k=k+1
    file.final.sensor<-file.final.scenario[which(file.final.scenario$sensor==i),]
    g<-ggplot(file.final.sensor,aes(x=Time..s.,y=P..hPa.))+geom_line()+theme_minimal()
    g<-g+geom_vline(aes(xintercept = Time..s., color = stage, linetype = stage), file.final.injection.nadir[which(file.final.injection.nadir$sensor==i),], size = 1)
    g<-g+scale_colour_manual(values = file.final.injection.nadir$color[which(file.final.injection.nadir$sensor==i)]) 
    g<-g+scale_linetype_manual(values = file.final.injection.nadir$line_type[which(file.final.injection.nadir$sensor==i)])
    g<-g+xlim(file.final.injection.nadir$Time..s.[which(file.final.injection.nadir$sensor==i & file.final.injection.nadir$stage=="injection")]-0.1,80)+ggtitle(paste0(s,"/",i))
    l[[k]]<-ggplotly(g)
    rm(file.final.sensor)
  }
  rm(file.final.scenario)
}
```

# Old_Axial_n_6

```{r}
l[[1]]
l[[2]]
l[[3]]
l[[4]]
l[[5]]
l[[6]]
```

P0 = First 1070 mbar crossing for pressure, AFTER injection event
P4 = Peak pressure after P0 (maximally 20 seconds after P0)

# Pump_40Hz_Control_n_13

```{r}
l[[7]]
l[[8]]
l[[9]]
l[[10]]
l[[11]]
l[[12]]
l[[13]]
l[[14]]
l[[15]]
l[[16]]
l[[17]]
l[[18]]
l[[19]]
```

P0 = First 1050 mbar crossing for pressure, AFTER injection event
P1 = Pressure maximum between the moment of nadir and one second before the moment of nadir
P2 = maximum immediately (within 1 second) after blade nadir
P3 = minimum immediately (within 1 second) after second local maximum (P2)
P4 = maximum of the control region, as sensor passes into the cage / net. Within 15 seconds after P3.

# Pump_40Hz_n_64

```{r}
l[[20]]
l[[21]]
l[[22]]
l[[23]]
l[[24]]
l[[25]]
l[[26]]
l[[27]]
l[[28]]
l[[29]]
l[[30]]
l[[31]]
l[[32]]
l[[33]]
l[[34]]
l[[35]]
l[[36]]
l[[37]]
l[[38]]
l[[39]]
l[[40]]
l[[41]]
l[[42]]
l[[43]]
l[[44]]
l[[45]]
l[[46]]
l[[47]]
l[[48]]
l[[49]]
l[[50]]
l[[51]]
l[[52]]
l[[53]]
l[[54]]
l[[55]]
l[[56]]
l[[57]]
l[[58]]
l[[59]]
l[[60]]
l[[61]]
l[[62]]
l[[63]]
l[[64]]
l[[65]]
l[[66]]
l[[67]]
l[[68]]
l[[69]]
l[[70]]
l[[71]]
l[[72]]
l[[73]]
l[[74]]
l[[75]]
l[[76]]
l[[77]]
l[[78]]
l[[79]]
l[[80]]
l[[81]]
l[[82]]
l[[83]]
```

P0 = First 1070 mbar crossing for pressure, AFTER injection event
P4 = Peak pressure after P0 (maximally 20 seconds after P0)

# Pump_47Hz_Control_n_15

```{r}
l[[84]]
l[[85]]
l[[86]]
l[[87]]
l[[88]]
l[[89]]
l[[91]]
l[[92]]
l[[93]]
l[[94]]
l[[95]]
l[[96]]
l[[97]]
l[[98]]
```

P0 = First 1050 mbar crossing for pressure, AFTER injection event
P1 = Pressure maximum between the moment of nadir and one second before the moment of nadir
P2 = Local maximum immediately (1 second) after blade nadir
P3 = Local minimum immediately (1 second) after second local maximum (P2)
P4 = Local maxima of the control region, as sensor passes into the cage / net. At least 1 second after P3.

# Pump_47Hz_n_51

```{r}
l[[99]]
l[[100]]
l[[101]]
l[[102]]
l[[103]]
l[[104]]
l[[105]]
l[[106]]
l[[107]]
l[[108]]
l[[109]]
l[[110]]
l[[111]]
l[[112]]
l[[113]]
l[[114]]
l[[115]]
l[[116]]
l[[117]]
l[[118]]
l[[119]]
l[[120]]
l[[121]]
l[[122]]
l[[123]]
l[[124]]
l[[125]]
l[[126]]
l[[127]]
l[[128]]
l[[129]]
l[[130]]
l[[131]]
l[[132]]
l[[133]]
l[[134]]
l[[135]]
l[[136]]
l[[137]]
l[[138]]
l[[139]]
l[[140]]
l[[141]]
l[[142]]
l[[143]]
l[[144]]
l[[145]]
l[[146]]
l[[147]]
l[[148]]
```

