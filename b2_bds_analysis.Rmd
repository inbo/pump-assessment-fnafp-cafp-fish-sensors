---
title: "bds_analysis"
author: "Stijn Bruneel"
date: "2023-03-07"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, echo=TRUE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```

```{r}
output<-"html"
```

```{r}
# import libraries from file
source("./source/not_functions/libraries.R")
```

```{r}
file.final.injection.nadir.wide <- read.csv("data/bds/internal/All_BDS_data_ROIs_OK.csv")
file.final <- read.csv("data/bds/internal/All_BDS_data_final_OK.csv")
```

# Data preparation

## Remove sensors

```{r}
sensors_to_remove<-c("B261212110906","B421212135906","B121211152453","B421212111410","B101211162356","B281212134647","B721212113506")
reason_for_removal<-c("","","","","too low nadir pressure","too low nadir pressure","too low nadir pressure")
file.final <- file.final[!(file.final$sensor %in% sensors_to_remove),]
file.final.injection.nadir.wide <- file.final.injection.nadir.wide[!(file.final.injection.nadir.wide$sensor %in% sensors_to_remove),]
print(paste("This sensor is removed, because",reason_for_removal,":",sensors_to_remove))
```

```{r eval=FALSE}
file.final.injection.nadir.wide$ROI1<-interval(start=file.final.injection.nadir.wide$Time..s._injection,end=file.final.injection.nadir.wide$Time..s._P0)

x = Intervals(
  matrix(c(file.final.injection.nadir.wide$Time..s._injection, file.final.injection.nadir.wide$Time..s._P0,
           file.final.injection.nadir.wide$Time..s._P0, file.final.injection.nadir.wide$Time..s._P1,
           file.final.injection.nadir.wide$Time..s._P1, file.final.injection.nadir.wide$Time..s._nadir_pressure,
           file.final.injection.nadir.wide$Time..s._nadir_pressure, file.final.injection.nadir.wide$Time..s._P2,
           file.final.injection.nadir.wide$Time..s._P2, file.final.injection.nadir.wide$Time..s._P3,
           file.final.injection.nadir.wide$Time..s._P3, file.final.injection.nadir.wide$Time..s._P4
           ), nrow = 6, byrow = TRUE),
  closed = c(TRUE, FALSE), # intervals are of the form [a, b)
  type = "Z" # inputs are integers
)
```

## Set parameters

ROC1 (pressure difference over time from P1 to nadir), ROC2 (pressure difference over time from P2 to P3) and LRP (logarithm of the ratio of the acclimation pressure (1000 hPa) and nadir pressure) were determined.  

```{r}
acclimation_pressure<-1000
file.final.injection.nadir.wide$LRP<-log(acclimation_pressure/file.final.injection.nadir.wide$P..hPa._nadir_pressure)
print(paste("the acclimation pressure is",acclimation_pressure))

file.final.injection.nadir.wide <- file.final.injection.nadir.wide %>%
  mutate(ROC1 = (P..hPa._P1 - P..hPa._nadir_pressure)/(Time..s._P1-Time..s._nadir_pressure))

file.final.injection.nadir.wide <- file.final.injection.nadir.wide %>%
  mutate(ROC2 = (P..hPa._P2 - P..hPa._P3)/(Time..s._P2-Time..s._P3))
```

# Data exploration

## Overview

```{r}
file.final.injection.nadir.wide %>%
  group_by(scenario) %>%
  summarise(mean_LRP=mean(LRP),
            sd_LRP=sd(LRP),
            mean_nadir=mean(P..hPa._nadir_pressure),
            sd_nadir=sd(P..hPa._nadir_pressure),
            mean_ROC1=mean(ROC1),
            sd_ROC1=sd(ROC1),
            mean_ROC2=mean(ROC2),
            sd_ROC2=sd(ROC2))
```

## Correlation table

```{r}
res <- cor(file.final[,c("EX..deg.","EY..deg.","EZ..deg.","AXEarth..m.s2.","AYEarth..m.s2.","AZEarth..m.s2.","RX..rad.s.","RY..rad.s.","RZ..rad.s.","PL..hPa.","PC..hPa.","PR..hPa.","P..hPa.")])
res <- round(res, 2)
res %>% kable(caption="Pearson correlation coefficient of the different assessed variables")
```

## Boxplots

```{r}
cmpr<-list(c('CAFP','FNAFP - 468 rpm'),        
 c('CAFP','FNAFP - 550 rpm'),        
 c('FNAFP - 468 rpm','FNAFP - 550 rpm')
 )
symnum.args <- list(cutpoints = c(0, 0.0001, 0.001, 0.01, 0.05, Inf), symbols = c("****", "***", "**", "*", "ns"))
```

```{r fig.cap="Boxplots representing ROC1 per scenario."}
a<-ggplot(data=file.final.injection.nadir.wide,aes(scenario, log(ROC1*(-1))),size = 0.5, color = "black") + geom_boxplot(linetype = 1, position = position_dodge(0.5)) + ylab("log(ROC) (hPa/s)") + xlab("Scenario") + theme_bw() + theme(text = element_text(size = 12, family = "serif"), axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5, family = "serif"), strip.background = element_rect(colour = "black", fill = "white"), legend.position = "bottom") + stat_compare_means(comparisons = cmpr, method = "wilcox.test", symnum.args = symnum.args, p.adjust.method = "bonferroni", label='p.adj') + theme(axis.text.x=element_blank()) + theme(axis.title.x=element_blank())
print(a)
```

Scenarios with a higher LRP, have a lower nadir pressure and a higher higher risk of barotrauma.

```{r}
cmpr<-list(c('CAFP','FNAFP - 468 rpm Ctrl'),
 c('CAFP','FNAFP - 468 rpm'),        
 c('CAFP','FNAFP - 550 rpm Ctrl'),
 c('CAFP','FNAFP - 550 rpm'),        
 c('FNAFP - 468 rpm Ctrl','FNAFP - 468 rpm'),        
 c('FNAFP - 468 rpm Ctrl','FNAFP - 550 rpm Ctrl'),
 c('FNAFP - 468 rpm Ctrl','FNAFP - 550 rpm'),
 c('FNAFP - 468 rpm','FNAFP - 550 rpm'),
 c('FNAFP - 468 rpm','FNAFP - 550 rpm Ctrl'),
 c('FNAFP - 550 rpm Ctrl','FNAFP - 550 rpm')
 )
symnum.args <- list(cutpoints = c(0, 0.0001, 0.001, 0.01, 0.05, Inf), symbols = c("****", "***", "**", "*", "ns"))
```

```{r fig.cap="Boxplots representing LRP per scenario."}
b<-ggplot(data=file.final.injection.nadir.wide,aes(scenario, LRP),size = 0.5, color = "black") + geom_boxplot(linetype = 1, position = position_dodge(0.5)) + ylab("LRP (-)") + xlab("Scenario") + theme_bw() + theme(text = element_text(size = 12, family = "serif"), axis.text.x = element_text(angle =45, hjust = 0.5, vjust = 0.5, family = "serif"), strip.background = element_rect(colour = "black", fill = "white"), legend.position = "bottom") + stat_compare_means(comparisons = cmpr, method = "wilcox.test", symnum.args = symnum.args, p.adjust.method = "bonferroni", label='p.adj') + theme(axis.text.x=element_blank()) + theme(axis.title.x=element_blank())
print(b)
```

```{r fig.cap="Boxplots representing nadir pressure per scenario."}
c<-ggplot(data=file.final.injection.nadir.wide,aes(scenario, P..hPa._nadir_pressure),size = 0.5, color = "black") + geom_boxplot(linetype = 1, position = position_dodge(0.5)) + ylab("Nadir pressure (hPa)") + xlab("Scenario") + theme_bw() + theme(text = element_text(size = 12, family = "serif"), axis.text.x = element_text(angle =45, hjust = 0.5, vjust = 0.5, family = "serif"), strip.background = element_rect(colour = "black", fill = "white"), legend.position = "bottom") + stat_compare_means(comparisons = cmpr, method = "wilcox.test", symnum.args = symnum.args, p.adjust.method = "bonferroni", label='p.adj')
print(c)
```

```{r}
pdf("./figures/manuscript/BDS_boxplots.pdf",height = 12)
library(grid)
grid.newpage()
grid.draw(rbind(ggplotGrob(a), ggplotGrob(b), ggplotGrob(c), size = "last"))
dev.off()
```

## Non-parametric tests to compare scenarios

To assess whether the ROC1, LRP, and nadir pressure differ between scenarios, a Kruskal-Wallis test was applied. If a significant difference (p\<0.05) between any of the scenarios was found, post-hoc pairwise Wilcoxon ranks sum tests with Bonferroni correction were applied.

### Non-parametric tests to compare ROC1 between scenarios

```{r eval=FALSE}
krusk<-kruskal.test(ROC1 ~ scenario, data = file.final.injection.nadir.wide)
krusk <- kable(caption="ROC1 KW test")
```

```{r eval=FALSE}
as.data.frame(pairwise.wilcox.test(file.final.injection.nadir.wide$ROC1, file.final.injection.nadir.wide$scenario,p.adjust.method = "bonferroni")$p.value) %>% kable(caption="P-values for post-hoc pairwise Wilcoxon ranks sum tests for ROC1 with Bonferroni correction")
```

### Non-parametric tests to compare LRP between scenarios

There were significant differences between control and pump samples. There were no significant differences between pump scenarios.

```{r}
krusk<-kruskal.test(LRP ~ scenario, data = file.final.injection.nadir.wide)
krusk
```

```{r eval=FALSE}
as.data.frame(pairwise.wilcox.test(file.final.injection.nadir.wide$LRP, file.final.injection.nadir.wide$scenario,p.adjust.method = "bonferroni")$p.value) %>% kable(caption="P-values for post-hoc pairwise Wilcoxon ranks sum tests for LRP with Bonferroni correction")
```

### Non-parametric tests to compare nadir pressure between scenarios

There were significant differences between control and pump samples. Nadir pressures were significantly lower at 47Hz compared to 40Hz.

```{r}
krusk<-kruskal.test(P..hPa._nadir_pressure ~ scenario, data = file.final.injection.nadir.wide)
krusk
```

```{r eval=FALSE}
as.data.frame(pairwise.wilcox.test(file.final.injection.nadir.wide$P..hPa._nadir_pressure, file.final.injection.nadir.wide$scenario,p.adjust.method = "bonferroni")$p.value) %>% kable(caption="P-values for post-hoc pairwise Wilcoxon ranks sum tests for nadir pressure with Bonferroni correction")
```

## Nadir pressure cumulative distribution functions

```{r}
pdf("./figures/manuscript/CDF_Nadir.pdf")
g<-ggplot(file.final.injection.nadir.wide, aes(P..hPa._nadir_pressure,colour=scenario)) + stat_ecdf(geom = "step") + ylab("F(Nadir pressure)") + xlab("Nadir pressure (hPa)") + theme_minimal()
g
dev.off()
g
```

## Time series plots of pressure and acceleration

To account for the variable temporal length between the moment of injection, nadir pressure and exit between sensors, a linear registration was applied. This linear registration interpolates each trajectory at 500 equally spaced time points between injection and nadir, and 500 equally spaced time points between nadir and exit. 

Because of this rescaling and due to the fact that the time between injection, nadir and exit were not constant among sensors, a temporal mismatch between rescaled measurements of different sensors occurred. To account for this, rescaled temporal values were rounded to the closest multiple of 0.001. For each scenario the average, median, standard deviation, count, standard error and lower and upper 95 % CIs per multiple of 0.001 were determined. 

```{r}
# Option2: Slower but nadir pressure and P4 are exactly 0.5 and 1 respectively: preferred choice
# Normalization with injection, nadir and exit at 0, 0.5 and 1
# splitted linear registration
file.final.normalization<-file.final %>%
  filter(relative.to.injection>=0 & relative.to.P4<=0) %>%
  group_by(sensor) %>%
  mutate(max.relative.to.nadir=max(relative.to.nadir),
         min.relative.to.nadir=min(relative.to.nadir)) %>%
  mutate(count=case_when(relative.to.nadir<=0 ~ abs(min.relative.to.nadir),.default = abs(max.relative.to.nadir))) %>%
  mutate(s=case_when(relative.to.nadir<=0 ~ relative.to.injection/(2*count),
                     .default = 0.5+relative.to.nadir/(2*count))) %>%
  mutate(s_time=as.POSIXct(s,format="%OS",origin='1970-01-01'),
         s_rounded=RoundTo(s, multiple = 0.001, FUN = round))

# Normalization with injection and exit at 0 and 1
# linear registration
# file.final.normalization<-file.final %>%
#   filter(relative.to.injection>=0 & relative.to.P4<=0) %>%
#   group_by(sensor) %>%
#   arrange(Time..s.) %>%
#   mutate(count=n(),row_number=row_number()) %>%
#   mutate(s=row_number/count) %>%
#   mutate(s_time=as.POSIXct(s,format="%OS",origin='1970-01-01'),
#          s_rounded=RoundTo(s, multiple = 0.001, FUN = round))
```

```{r}
normalized.plots.timeseries<-function(var.name){
  scenario<-unique(file.final.normalization$scenario)
  l <- list()
  k = 0
  for (s in scenario){
    k=k+1
    temp<-file.final.normalization[which(file.final.normalization$scenario==s),]
    g<-ggplot(temp,aes(x=s,y=!!as.name(var.name),colours=sensor))+geom_line()+theme_minimal()+ggtitle(s)
    if (output=="word"){l[[k]]<-g} else{l[[k]]<-ggplotly(g)}
    rm(temp)
  }
  return(l)
}
```

```{r}
plots.pressure<-normalized.plots.timeseries(var.name=quote("P..hPa."))
plots.acc.x<-normalized.plots.timeseries(var.name=quote("AXEarth..m.s2."))
plots.acc.y<-normalized.plots.timeseries(var.name=quote("AYEarth..m.s2."))
plots.acc.z<-normalized.plots.timeseries(var.name=quote("AZEarth..m.s2."))
```

### Time series plots of pressure per scenarios for all sensors

```{r}
plots.pressure[[1]]
plots.pressure[[2]]
plots.pressure[[3]]
plots.pressure[[4]]
plots.pressure[[5]]
rm(plots.pressure)
```

### Time series plots of acceleration x per scenarios for all sensors

```{r}
plots.acc.x[[1]]
plots.acc.x[[2]]
plots.acc.x[[3]]
plots.acc.x[[4]]
plots.acc.x[[5]]
rm(plots.acc.x)
```

### Time series plots of acceleration y per scenarios for all sensors

```{r}
plots.acc.y[[1]]
plots.acc.y[[2]]
plots.acc.y[[3]]
plots.acc.y[[4]]
plots.acc.y[[5]]
rm(plots.acc.y)
```

### Time series plots of acceleration z per scenarios for all sensors

```{r}
plots.acc.z[[1]]
plots.acc.z[[2]]
plots.acc.z[[3]]
plots.acc.z[[4]]
plots.acc.z[[5]]
rm(plots.acc.z)
```

```{r}
normalized.plots.timeseries.summarized<-function(var.name,stat){
  scenario<-unique(file.final.normalization$scenario)
  l <- list()
  k = 0
  for (s in scenario){
    k=k+1
    temp<-file.final.normalization[which(file.final.normalization$scenario==s),]
    setorder(temp, s)
    temp <- temp %>%
      select(!!as.name(var.name),s_rounded) %>%
      group_by(s_rounded) %>%
      summarise(mean=mean(!!as.name(var.name)),median=median(!!as.name(var.name)),sd=sd(!!as.name(var.name)),n=n(),q25=quantile(!!as.name(var.name),probs=0.25),q75=quantile(!!as.name(var.name),probs=0.75)) %>%
      mutate(se = sd / n,
             t_score = qt(p=0.05/2,df=n,lower.tail=F),
             margin_error = t_score * se,
             lower_bound_mean = mean - margin_error,
             upper_bound_mean = mean + margin_error
             )
    if (stat=="mean"){
      g<-ggplot(temp,aes(x=s_rounded,y=mean))+geom_line()+theme_minimal()+ggtitle(s)+geom_ribbon(aes(ymin=lower_bound_mean, ymax=upper_bound_mean), alpha=0.2)
      if (output=="word"){l[[k]]<-g} else{l[[k]]<-ggplotly(g)}
    }
    if (stat=="median"){
      g<-ggplot(temp,aes(x=s_rounded,y=median))+geom_line()+theme_minimal()+ggtitle(s)+geom_ribbon(aes(ymin=q25, ymax=q75), alpha=0.2)
      if (output=="word"){l[[k]]<-g} else{l[[k]]<-ggplotly(g)}
    }
    rm(temp)
  }
  return(l)
}
```

## Time series plots of pressure and acceleration, averaged over all sensors with 95% CI

```{r}
plots.pressure.mean<-normalized.plots.timeseries.summarized(var.name=quote("P..hPa."),stat="mean")
plots.acc.x.mean<-normalized.plots.timeseries.summarized(var.name=quote("AXEarth..m.s2."),stat="mean")
plots.acc.y.mean<-normalized.plots.timeseries.summarized(var.name=quote("AYEarth..m.s2."),stat="mean")
plots.acc.z.mean<-normalized.plots.timeseries.summarized(var.name=quote("AZEarth..m.s2."),stat="mean")
```

### Time series plots of pressure, averaged over all sensors with 95% CI

```{r}
plots.pressure.mean[[1]]
plots.pressure.mean[[2]]
plots.pressure.mean[[3]]
plots.pressure.mean[[4]]
plots.pressure.mean[[5]]
rm(plots.pressure.mean)
```

### Time series plots of acceleration x, averaged over all sensors with 95% CI

```{r}
plots.acc.x.mean[[1]]
plots.acc.x.mean[[2]]
plots.acc.x.mean[[3]]
plots.acc.x.mean[[4]]
plots.acc.x.mean[[5]]
rm(plots.acc.x.mean)
```

### Time series plots of acceleration y, averaged over all sensors with 95% CI

```{r}
plots.acc.y.mean[[1]]
plots.acc.y.mean[[2]]
plots.acc.y.mean[[3]]
plots.acc.y.mean[[4]]
plots.acc.y.mean[[5]]
rm(plots.acc.y.mean)
```

### Time series plots of acceleration z, averaged over all sensors with 95% CI

```{r}
plots.acc.z.mean[[1]]
plots.acc.z.mean[[2]]
plots.acc.z.mean[[3]]
plots.acc.z.mean[[4]]
plots.acc.z.mean[[5]]
rm(plots.acc.z.mean)
```

## Time series plots of pressure and acceleration per scenario, median over all sensors with 25% and 75% quantiles

```{r}
plots.pressure.median<-normalized.plots.timeseries.summarized(var.name=quote("P..hPa."),stat="median")
plots.acc.x.median<-normalized.plots.timeseries.summarized(var.name=quote("AXEarth..m.s2."),stat="median")
plots.acc.y.median<-normalized.plots.timeseries.summarized(var.name=quote("AYEarth..m.s2."),stat="median")
plots.acc.z.median<-normalized.plots.timeseries.summarized(var.name=quote("AZEarth..m.s2."),stat="median")
```

### Time series plots of pressure, averaged over all sensors with 95% CI

```{r}
plots.pressure.median[[1]]
plots.pressure.median[[2]]
plots.pressure.median[[3]]
plots.pressure.median[[4]]
plots.pressure.median[[5]]
rm(plots.pressure.median)
```

### Time series plots of acceleration x, averaged over all sensors with 95% CI

```{r}
plots.acc.x.median[[1]]
plots.acc.x.median[[2]]
plots.acc.x.median[[3]]
plots.acc.x.median[[4]]
plots.acc.x.median[[5]]
rm(plots.acc.x.median)
```

### Time series plots of acceleration y, averaged over all sensors with 95% CI

```{r}
plots.acc.y.median[[1]]
plots.acc.y.median[[2]]
plots.acc.y.median[[3]]
plots.acc.y.median[[4]]
plots.acc.y.median[[5]]
rm(plots.acc.y.median)
```

### Time series plots of acceleration z, averaged over all sensors with 95% CI

```{r}
plots.acc.z.median[[1]]
plots.acc.z.median[[2]]
plots.acc.z.median[[3]]
plots.acc.z.median[[4]]
plots.acc.z.median[[5]]
rm(plots.acc.z.median)
```

## Time series plots of pressure, averaged over all sensors with 95% CI, median over all sensors with 25% and 75% quantiles, combined into 1 figure

```{r}
var.name=quote("P..hPa.")
stat="mean"
temp<-file.final.normalization
  setorder(temp, scenario, s)
  temp <- temp %>%
    select(!!as.name(var.name),s_rounded,scenario) %>%
    group_by(s_rounded,scenario) %>%
    summarise(mean=mean(!!as.name(var.name)),median=median(!!as.name(var.name)),sd=sd(!!as.name(var.name)),n=n(),q25=quantile(!!as.name(var.name),probs=0.25),q75=quantile(!!as.name(var.name),probs=0.75)) %>%
    mutate(se = sd / n,
           t_score = qt(p=0.05/2,df=n,lower.tail=F),
           margin_error = t_score * se,
           lower_bound_mean = mean - margin_error,
           upper_bound_mean = mean + margin_error
           )
g<-ggplot(temp,aes(x=s_rounded,y=mean,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=lower_bound_mean, ymax=upper_bound_mean, fill=scenario), alpha=0.2, colour = NA) + ylim(600,1300) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=1-1/10, y=1300, label= "(A)", size=6) #+ ggtitle("Time series plots of pressure, averaged over all sensors with 95% CI")
h<-ggplot(temp,aes(x=s_rounded,y=median,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=q25, ymax=q75, fill=scenario), alpha=0.2, colour = NA) + ylim(600,1300) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=1-1/10, y=1300, label= "(B)", size=6) #+ ggtitle("Time series plots of pressure, median over all sensors with Q25% and Q75%")
i<-ggplot(temp[which(temp$scenario=="FNAFP - 468 rpm" | temp$scenario=="FNAFP - 550 rpm"),],aes(x=s_rounded,y=mean,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=lower_bound_mean, ymax=upper_bound_mean, fill=scenario), alpha=0.2, colour = NA) + ylim(900,1300) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=1-1/10, y=1300, label= "(A)", size=6) #+ ggtitle("Time series plots of pressure, averaged over all sensors with 95% CI")
j<-ggplot(temp[which(temp$scenario=="FNAFP - 468 rpm" | temp$scenario=="FNAFP - 550 rpm"),],aes(x=s_rounded,y=median,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=q25, ymax=q75, fill=scenario), alpha=0.2, colour = NA) + ylim(900,1300) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=1-1/10, y=1300, label= "(B)", size=6) #+ ggtitle("Time series plots of pressure, median over all sensors with Q25% and Q75%")
k<-ggplot(temp[which(temp$scenario=="FNAFP - 468 rpm" | temp$scenario=="FNAFP - 550 rpm"),],aes(x=s_rounded,y=mean,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=lower_bound_mean, ymax=upper_bound_mean, fill=scenario), alpha=0.2, colour = NA) + ylim(900,1300) + xlim(0.4,0.6) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=0.6-0.2/10, y=1300, label= "(C)", size=6) #+ ggtitle("Time series plots of pressure, averaged over all sensors with 95% CI")
l<-ggplot(temp[which(temp$scenario=="FNAFP - 468 rpm" | temp$scenario=="FNAFP - 550 rpm"),],aes(x=s_rounded,y=median,color=scenario))+geom_line(alpha=0.5)+theme_minimal()+geom_ribbon(aes(ymin=q25, ymax=q75, fill=scenario), alpha=0.2, colour = NA) + ylim(900,1300) + xlim(0.4,0.6) + xlab("Normalized passage duration") + ylab("Pressure (hPa)") + annotate("text", x=0.6-0.2/10, y=1300, label= "(D)", size=6) #+ ggtitle("Time series plots of pressure, median over all sensors with Q25% and Q75%")
g
h
i
j
k
l
pdf("./figures/manuscript/timeseries_all.pdf")
ggarrange(g,h,legend="right",common.legend = TRUE,ncol=1)
dev.off()
pdf("./figures/manuscript/timeseries_selection.pdf")
ggarrange(i,j,k,l,common.legend = TRUE)
dev.off()
```

```{r}
file.final <- file.final[order(file.final$local_maxima_AX,-file.final$AXEarth..m.s2.),]
```

